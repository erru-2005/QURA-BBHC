<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>All Books - Library Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        min-height: 100vh;
        background: linear-gradient(to bottom right, #f3f4f6, #e5e7eb);
      }

      /* Glass Card Effect */
      .glass-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
      }

      /* Gradient Border */
      .gradient-border {
        position: relative;
      }
      .gradient-border::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(to right, #6366f1, #ec4899, #8b5cf6);
      }

      /* Color Transitions */
      .hover-gradient:hover {
        background: linear-gradient(to right, rgba(99, 102, 241, 0.1), rgba(236, 72, 153, 0.1));
      }
    </style>
  </head>
  <body class="bg-gradient-to-br from-gray-50 to-gray-100">
    <div class="min-h-screen">
      <main class="w-full mt-4">
        <!-- Content Wrapper for internal elements -->
        <div class="max-w-6xl mx-auto px-4">
          <!-- HEADER -->
<header class="relative bg-white/80 backdrop-blur-lg p-6 rounded-2xl mb-8 shadow-lg border border-white/30 transition-all duration-500 hover:shadow-2xl">
  <div class="flex flex-col md:flex-row justify-between items-center gap-6 text-center md:text-left">

    <!-- Logo + Title -->
    <div class="flex flex-col md:flex-row items-center gap-4">
      <img
        src="{{url_for('static', filename='logo-removebg-preview.png')}}"
        alt="College Logo"
        class="h-16 md:h-20 w-auto object-contain drop-shadow-md"
      />
      <div>
        <h1 class="text-lg md:text-2xl font-bold text-[#6b1111] drop-shadow-sm leading-tight">
          Dr. B. B. Hegde First Grade College, Kundapura
        </h1>
        <p class="text-xs md:text-sm text-gray-600 mt-1">
          A Unit of Coondapur Education Society (R)
        </p>
      </div>
    </div>

    <!-- Button -->
    <a
      href="/statistic"
      class="group inline-flex justify-center items-center gap-2 px-5 py-3 rounded-xl shadow-md 
             bg-gradient-to-r from-red-500 to-indigo-600 
             hover:from-red-600 hover:to-indigo-700 text-white font-semibold 
             transition-all transform hover:scale-105 hover:shadow-lg w-full md:w-auto"
    >
    <svg xmlns="http://www.w3.org/2000/svg"
    fill="none" viewBox="0 0 24 24" stroke="currentColor"
    class="w-5 h-5">
 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
       d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
</svg>
      <span>OPAC</span>
    </a>

  </div>
</header>

<!-- SEARCH BAR -->
<div class="flex flex-col md:flex-row gap-4 mb-8 justify-center items-center 
            bg-white/80 backdrop-blur-lg p-6 rounded-2xl shadow-lg border border-white/30 w-full">
  
  <input
    type="text"
    id="search-input"
    placeholder="Search books..."
    class="flex-1 min-w-[250px] px-4 py-2 rounded-lg border-2 border-indigo-100 
           focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 
           transition-all duration-300 shadow-sm w-full md:w-auto"
  />

  <select 
    id="filter-department"
    class="px-4 py-2 rounded-lg border-2 border-pink-100 
           focus:border-pink-500 focus:ring-2 focus:ring-pink-200 
           transition-all duration-300 shadow-sm w-full md:w-auto"
  >
    <option value="">All Departments</option>
    <!-- Options will be populated dynamically -->
  </select>
</div>

<!-- Main Content -->
<section class="mb-8">
  <div class="text-center mb-6">
    <h2 class="text-2xl sm:text-3xl font-bold text-[#6b1111] mb-1">
      Online Public Access Catalog (OPAC)
    </h2>
    <p class="text-gray-600 text-sm sm:text-base">
     Discover every book in our library, all in one place
    </p>
  </div>

  <!-- Books Display -->
  <div id="books-container" 
       class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 pb-20">
    <!-- Books will be populated here -->
  </div>

  <!-- Pagination -->
  <div id="pagination" class="flex flex-wrap justify-center items-center gap-2 mt-6">
    <!-- Pagination controls will be populated here -->
  </div>

  <!-- Loading State -->
  <div id="loading" class="text-center py-8 hidden">
    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-red-500"></div>
    <p class="mt-2 text-gray-600 text-sm">Loading books...</p>
  </div>
</section>

<!-- Footer -->
<footer class="bg-gradient-to-r from-gray-800 via-gray-900 to-gray-800 text-white fixed bottom-0 left-0 w-full shadow-lg z-50">
  <div class="max-w-6xl mx-auto px-4 py-3 text-center">
    <!-- Designed By -->
    <div class="mb-1 text-xs sm:text-sm">
      Designed by 
      <span class="font-medium text-gray-300">III Year BCA (2025–26 Batch)</span>
      <span class="text-gray-500"> | Under Guidance of </span>
      <span class="font-medium text-gray-300">Mr. Pranam Betrabet</span>
    </div>

    <!-- Divider -->
    <div class="border-t border-gray-700 w-1/2 mx-auto my-1"></div>

    <!-- Copyright -->
    <div class="text-[10px] sm:text-xs text-gray-500 leading-tight">
      © 2025 <span class="font-medium text-gray-300">Dr. B. B. Hegde First Grade College, Kundapura</span> — All Rights Reserved
    </div>
  </div>
</footer>

<style>
  /* Make page full height with space for footer */
  html, body {
    height: 100%;
    margin: 0;
  }
  body {
    display: flex;
    flex-direction: column;
  }
  section {
    flex: 1;
    overflow-y: auto; /* Only content scrolls */
  }
  #books-container {
    padding-bottom: 100px; /* extra space so cards don't get hidden */
  }
</style>



    <script>
  // State management
  let searchTimeout;
  const state = {
    books: [],
    searchQuery: '',
    department: '',
    hasSearched: false
  };

  // DOM elements
  const searchInput = document.getElementById('search-input');
  const departmentSelect = document.getElementById('filter-department');
  const booksContainer = document.getElementById('books-container');
  const loading = document.getElementById('loading');

  // Initialize
  document.addEventListener('DOMContentLoaded', () => {
    loadDepartments();
    // Show search prompt instead of loading books immediately
    booksContainer.innerHTML = `
      <div class="col-span-full text-center py-12">
        <div class="max-w-md mx-auto">
          <h3 class="text-lg font-semibold text-gray-700 mb-2">Search for Books</h3>
          <p class="text-gray-500 text-sm">Use the search bar above to find books by title, author, or department</p>
          <div class="mt-4 text-blue-600">
            <svg class="w-8 h-8 mx-auto animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12" />
            </svg>
          </div>
        </div>
      </div>
    `;

    // Real-time search with debouncing
    searchInput.addEventListener('input', () => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        state.searchQuery = searchInput.value.trim();
        if (state.searchQuery.length >= 2) { // Search after 2 characters
          searchBooks();
        } else if (state.searchQuery.length === 0 && state.hasSearched) {
          // If search is cleared and had previous results, show all books
          loadAllBooks();
        }
      }, 300);
    });

    // Department filter
    departmentSelect.addEventListener('change', () => {
      state.department = departmentSelect.value;
      if (state.hasSearched || state.department) {
        searchBooks();
      }
    });

    // Focus search input on load
    searchInput.focus();
  });

  // Load departments
  async function loadDepartments() {
    try {
      const response = await fetch('/api/departments');
      const departments = await response.json();
      
      // Clear and add default option
      departmentSelect.innerHTML = '<option value="">All Departments</option>';
      
      // Add department options
      departments.forEach(dept => {
        if (dept) { // Only add non-empty departments
          const option = document.createElement('option');
          option.value = dept;
          option.textContent = dept;
          departmentSelect.appendChild(option);
        }
      });
    } catch (error) {
      console.error('Error loading departments:', error);
    }
  }

  // Search books
  async function searchBooks() {
    showLoading(true);
    state.hasSearched = true;
    
    try {
      const params = new URLSearchParams({
        q: state.searchQuery,
        department: state.department
      });

      const response = await fetch(`/api/books?${params}`);
      const data = await response.json();
      
      displayBooks(data.books);
    } catch (error) {
      console.error('Error searching books:', error);
      booksContainer.innerHTML = '<p class="text-center text-red-500">Error loading books</p>';
    } finally {
      showLoading(false);
    }
  }

  // Load all books
  async function loadAllBooks() {
    showLoading(true);
    try {
      const response = await fetch('/api/books');
      const data = await response.json();
      displayBooks(data.books);
    } catch (error) {
      console.error('Error loading all books:', error);
    } finally {
      showLoading(false);
    }
  }

  // Display books with animation
  function displayBooks(books) {
    if (!books.length) {
      booksContainer.innerHTML = '<p class="text-center text-gray-500 col-span-full">No books found</p>';
      return;
    }

    booksContainer.innerHTML = books.map((book, index) => `
  <div class="rounded-xl overflow-hidden shadow-md hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1"
       style="animation: fadeIn 0.3s ease-out forwards ${index * 50}ms">
    <div class="bg-white p-6 md:p-8 flex flex-col h-full space-y-4">
      
      <!-- Title -->
      <h3 class="text-xl md:text-2xl font-bold text-gray-900 leading-snug">
        ${book.title || 'Untitled'}
      </h3>
      
      <!-- Book Details -->
      <div class="space-y-2 text-gray-700 flex-grow text-sm md:text-base">
        <p><span class="font-semibold text-orange-600">Accession Number:</span> ${book.accession_number || 'N/A'}</p>
        <p><span class="font-semibold text-pink-600">Author:</span> ${book.author || 'Unknown'}</p>
        
        <p><span class="font-semibold text-indigo-600">Department:</span> ${book.department || 'N/A'}</p>
        <p><span class="font-semibold text-purple-600">Barcode:</span> ${book.barcode || 'N/A'}</p>
      </div>
      
      <!-- Footer -->
      <div class="pt-4 border-t border-gray-200 flex justify-between items-center">
        ${book.status === 'available' ? 
          `<span class="px-4 py-1.5 rounded-full text-xs font-semibold bg-green-100 text-green-700">
            Available
          </span>` : 
          `<span class="px-4 py-1.5 rounded-full text-xs font-semibold bg-red-100 text-red-700">
            Unavailable
          </span>`
        }
        <span class="px-4 py-1.5 rounded-full text-xs font-semibold bg-green-50 text-green-700">
            
          </span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400 hover:text-indigo-500 transition-colors duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </div>
    </div>
  </div>
`).join('');


  }

  function showLoading(show) {
    loading.classList.toggle('hidden', !show);
  }
</script>
  </body>
</html>