<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Library Statistics - BBHC College</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      html, body {
        height: 100vh;
        margin: 0;
        position: relative;
      }
      .glass-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 
          0 8px 32px rgba(0, 0, 0, 0.1),
          0 4px 16px rgba(0, 0, 0, 0.05);
      }
      .floating-animation {
        animation: float 6s ease-in-out infinite;
      }
      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
      }
      .search-input-glow:focus {
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
      }
      .option-selector {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        border: 2px solid #e2e8f0;
        transition: all 0.3s ease;
      }
      .option-selector:hover {
        border-color: #6366f1;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.15);
      }
      .suggestion-item {
        transition: all 0.2s ease;
        border-radius: 8px;
        margin: 2px 4px;
      }
      .suggestion-item:hover {
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        transform: translateX(4px);
      }
      .results-card {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
      }
      .results-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        border-color: #6366f1;
      }
      main h1, main h2 {
        font-size: 90%;
      }
      main input, main button {
        font-size: 0.95rem;
        padding: 0.75rem 1rem;
      }
    </style>
  </head>
 <body>
  <main class="w-full bg-gradient-to-br from-[#1a120b] via-[#2c1810] to-[#0f0a07] text-white min-h-screen pb-20">
    <!-- Header Section -->
    <section class="mx-auto max-w-6xl">
      <header class=" py-5 px-6 flex flex-col md:flex-row justify-between items-center gap-4 
                     bg-gradient-to-r from-[#1a120b] via-[#2c1810] to-[#1a120b]
                     shadow-[0_0_30px_rgba(43,26,16,0.7)] rounded-2xl 
                     border border-amber-900/20 relative overflow-hidden">
        <!-- Ambient Glow Effect -->
        <div class="absolute inset-0 bg-gradient-to-r from-amber-600/5 via-red-600/5 to-purple-600/5 animate-pulse"></div>
        
        <!-- Left Section -->
        <div class="flex flex-col md:flex-row items-center gap-4 text-center md:text-left relative z-10">
          <div class="relative flex-shrink-0">
            <!-- Spreading light effects -->
            <div class="absolute -inset-4 bg-gradient-radial from-amber-500/20 via-amber-500/5 to-transparent 
                        rounded-full blur-xl transform-gpu animate-pulse"></div>
            <div class="absolute -inset-8 bg-gradient-radial from-orange-500/10 via-amber-500/5 to-transparent 
                        rounded-full blur-2xl transform-gpu animate-pulse delay-150"></div>
            <!-- Logo wrapper with light spread -->
            <div class="relative">
              <div class="absolute -inset-2 bg-gradient-radial from-orange-500/20 via-amber-500/10 to-transparent 
                          rounded-full blur-md animate-pulse-slow"></div>
              <img
                src="{{ url_for('static', filename='logo-removebg-preview.png') }}"
                alt="College Logo"
                class="h-16 sm:h-20 w-auto object-contain relative z-10
                       drop-shadow-[0_0_8px_rgba(255,140,0,0.2)]"
              />
            </div>
          </div>

          <div>
            <h1 class="text-lg sm:text-xl md:text-2xl font-bold text-amber-100 leading-tight
                       drop-shadow-[0_2px_10px_rgba(251,146,60,0.3)]">
              Dr. B. B. Hegde First Grade College, Kundapura
            </h1>
            <p class="text-sm sm:text-base text-amber-200/60 mt-1 font-medium">
              A Unit of Coondapur Education Society (R)
            </p>
          </div>
        </div>

        <!-- Right Section -->
        <div class="relative z-10 flex gap-3">
          <a href="/"
             class="inline-flex items-center gap-2 px-5 py-3 rounded-xl
                    bg-gradient-to-r from-blue-500/10 to-purple-500/10
                    border border-blue-500/20 backdrop-blur-sm
                    text-blue-100 font-semibold 
                    shadow-[0_0_15px_rgba(59,130,246,0.15)]
                    transition-all duration-300 
                    hover:bg-gradient-to-r hover:from-blue-500/20 hover:to-purple-500/20
                    hover:border-blue-500/30 hover:shadow-[0_0_20px_rgba(59,130,246,0.25)]">
            <svg xmlns="http://www.w3.org/2000/svg"
                 fill="none" viewBox="0 0 24 24" stroke="currentColor"
                 class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
            All Books
          </a>
        </div>
      </header>
    </section>

    <!-- Search Section -->
    <section class="mt-8 mb-24 px-4">
      <!-- Header -->
      <div class="text-center mb-8">
        <h2 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-3 drop-shadow-sm">
          Library Statistics Search
        </h2>
        <p class="text-gray-500 text-lg font-medium max-w-2xl mx-auto">
          Discover our comprehensive library collection with intelligent search
        </p>
      </div>

      <!-- Search Type Selector -->
      <div class="flex items-center justify-center gap-4 md:gap-6 mb-8">
        <button id="prev"
          class="p-3 rounded-full border border-gray-200 hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 transition-all duration-300 shadow-sm">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
            stroke="currentColor" width="20" height="20" class="text-gray-600">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M15 19l-7-7 7-7" />
          </svg>
        </button>

        <div class="text-center">
          <div id="current-option"
            class="text-lg md:text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent transition-all duration-300 px-4 py-2 rounded-xl bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 shadow-inner">
            Title
          </div>
        </div>

        <button id="next"
          class="p-3 rounded-full border border-gray-200 hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50 transition-all duration-300 shadow-sm">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
            stroke="currentColor" width="20" height="20" class="text-gray-600">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9 5l7 7-7 7" />
          </svg>
        </button>
      </div>

      <!-- Search Form -->
      <form id="search-form" class="max-w-2xl mx-auto">
        <div class="relative w-full">
          <!-- Search Input -->
          <div class="relative">
            <input 
              type="text" 
              id="search-input" 
              name="search_query"
              placeholder="Search books..."
              class="w-full px-5 py-4 text-lg rounded-2xl
                     outline-none focus:outline-none 
                     appearance-none bg-white/90 
                     backdrop-blur-sm text-gray-900 
                     shadow-lg border-0 placeholder-gray-400"
            />
            <input 
              type="hidden" 
              id="search-type-hidden" 
              name="search_type"
              value="Title"
            />
            <div class="absolute right-4 top-1/2 -translate-y-1/2">
              <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </div>
          </div>

          <!-- Suggestions Dropdown -->
          <div id="suggestions" 
               class="absolute w-full mt-1 py-2
                      bg-white rounded-xl shadow-lg 
                      border border-gray-100
                      transition-all duration-200
                      hidden z-50">
          </div>
        </div>

        <!-- Search Button -->
        <div class="text-center mt-6">
          <button type="submit" id="search-btn"
            class="px-8 py-4 bg-gradient-to-r from-indigo-600 to-purple-600
                   hover:from-indigo-700 hover:to-purple-700 text-white text-lg font-bold
                   rounded-xl shadow-lg transform transition-all duration-200
                   hover:scale-105 hover:shadow-xl min-w-[200px]">
            Search
          </button>
        </div>
      </form>
    </section>

    <!-- Results Section -->
    <section id="results" class="mt-8 px-4 hidden">
      <div class="max-w-6xl mx-auto">
        <div class="bg-white/10 backdrop-blur-sm p-8 rounded-3xl border border-white/20 shadow-2xl">
          <h3 class="text-3xl font-bold mb-8 text-center bg-gradient-to-r from-amber-100 to-purple-200 bg-clip-text text-transparent">
            Search Results
          </h3>
          <div id="results-container" class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
            <!-- Results will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </section>

    <!-- Dynamic Search Results Section -->
    <section id="dynamic-results" class="mt-8 px-4 hidden">
      <div class="max-w-6xl mx-auto">
        <div class="bg-gradient-to-br from-amber-900 via-amber-800 to-amber-700 p-8 rounded-3xl shadow-2xl border border-amber-600">
          <h3 id="dynamic-header" class="text-3xl font-bold mb-8 text-center bg-gradient-to-r from-amber-100 to-yellow-100 bg-clip-text text-transparent">
            Search Results
          </h3>
          
          <div id="dynamic-results-container" class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
            <!-- Dynamic results will be populated by JavaScript -->
          </div>

          <!-- Additional Info -->
          <div class="mt-8 text-center">
            <div class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-amber-200 to-yellow-200 rounded-full border border-amber-400">
              <svg class="w-5 h-5 text-amber-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span id="search-type-display" class="text-amber-800 font-medium">Search Type: </span>
            </div>
          </div>
        </div>
      </div>
      
    </section>
        
  </main>
<footer class="bg-gradient-to-r from-rose-700 to-indigo-800 text-white rounded-lg">
  <div class="max-w-6xl mx-auto px-3 py-3 text-center text-sm">
    <div>Designed by <strong>III Year BCA (2025–26 Batch)</strong> | Under Guidance of <strong>Mr. Pranam Betrabet</strong></div>
  </div>
</footer>
  <script>
    const options = ["Title", "Author", "Department", "Department Code"];
    let currentIndex = 0;

    const display = document.getElementById("current-option");
    const prev = document.getElementById("prev");
    const next = document.getElementById("next");
    const searchInput = document.getElementById("search-input");
    const hiddenField = document.getElementById("search-type-hidden");
    const suggestionsBox = document.getElementById("suggestions");
    const searchForm = document.getElementById("search-form");
    const searchBtn = document.getElementById("search-btn");
    const resultsSection = document.getElementById("results");
    const resultsContainer = document.getElementById("results-container");

    function updateDisplay() {
      display.classList.add("opacity-0");
      setTimeout(() => {
        display.textContent = options[currentIndex];
        display.classList.remove("opacity-0");
        display.classList.add("opacity-100");
        searchInput.placeholder = "Search " + options[currentIndex] + "...";
        hiddenField.value = options[currentIndex];
        fetchSuggestions(searchInput.value);
      }, 150);
    }

    prev.addEventListener("click", () => {
      currentIndex = (currentIndex - 1 + options.length) % options.length;
      updateDisplay();
    });

    next.addEventListener("click", () => {
      currentIndex = (currentIndex + 1) % options.length;
      updateDisplay();
    });

    searchInput.addEventListener("input", () => {
      fetchSuggestions(searchInput.value);
    });

    // Fetch suggestions from API
    function fetchSuggestions(query) {
      if (!query.trim()) {
        suggestionsBox.classList.add('hidden');
        return;
      }

      const searchType = document.getElementById("current-option").textContent;
      
      // Make API call to get suggestions
      fetch(`/api/suggestions?type=${encodeURIComponent(searchType)}&q=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(suggestions => {
          if (suggestions.length > 0) {
            suggestionsBox.innerHTML = suggestions
              .map(suggestion => `
                <div class="suggestion-item cursor-pointer w-full text-left px-4 py-2 
                             hover:bg-indigo-50 flex items-center gap-3"
                     onclick="selectSuggestion('${suggestion.replace(/'/g, "\\'")}')">
                  <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                  </svg>
                  <div>
                    <div class="text-gray-900 font-medium">${suggestion}</div>
                    <div class="text-xs text-gray-500">${searchType}</div>
                  </div>
                </div>
              `).join('');
            
            suggestionsBox.classList.remove('hidden');
          } else {
            suggestionsBox.innerHTML = `
              <div class="px-4 py-2 text-center text-gray-500">
                No matching ${searchType.toLowerCase()} found
              </div>
            `;
            suggestionsBox.classList.remove('hidden');
          }
        })
        .catch(error => {
          console.error("Error fetching suggestions:", error);
          suggestionsBox.innerHTML = `
            <div class="px-4 py-2 text-center text-red-500">
              Error loading suggestions
            </div>
          `;
          suggestionsBox.classList.remove('hidden');
        });
    }

    // Select suggestion function
    function selectSuggestion(suggestion) {
      searchInput.value = suggestion;
      suggestionsBox.classList.add('hidden');
      performSearch();
    }

    // Hide suggestions when clicking outside
    document.addEventListener('click', function(e) {
      if (!searchInput.contains(e.target) && !suggestionsBox.contains(e.target)) {
        suggestionsBox.classList.add('hidden');
      }
    });

    // Form submission handler
    searchForm.addEventListener('submit', function(e) {
      e.preventDefault();
      performSearch();
    });

    // Perform search function using real API
    function performSearch() {
      const query = searchInput.value.trim();
      const searchType = document.getElementById("current-option").textContent;
     
      if (!query) {
        alert("Please enter a search term");
        return;
      }

      // Show loading state
      searchBtn.disabled = true;
      const originalText = searchBtn.innerHTML;
      searchBtn.innerHTML = `
        <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <span class="ml-2">Searching...</span>
      `;

      // Make real API call to search endpoint
      fetch("/api/search", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ 
          query: query, 
          searchType: searchType 
        })
      })
      .then(response => response.json())
      .then(data => {
        
        if (data.error) {
          throw new Error(data.error);
        }
        
        // Hide the old results section
        resultsSection.classList.add('hidden');
        
        displayResults(data);
      })
      .catch(error => {
        console.error("Error:", error);
        alert("Error performing search: " + error.message);
      })
      .finally(() => {
        searchBtn.disabled = false;
        searchBtn.innerHTML = originalText;
      });
    }

    // Display results function
    function displayResults(data) {
      console.log("Search Results:", data);
      const { stats } = data;
      const dynamicResultsSection = document.getElementById('dynamic-results');
      const dynamicResultsContainer = document.getElementById('dynamic-results-container');
      const dynamicHeader = document.getElementById('dynamic-header');
      const searchTypeDisplay = document.getElementById('search-type-display');
      const searchType = document.getElementById("current-option").textContent;

      if (!results || results.length === 0) {
        dynamicResultsContainer.innerHTML = `
          <div class="col-span-3 text-center py-12">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4">
              <svg class="w-8 h-8 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </div>
            <p class="text-xl text-red-600 font-semibold">
              No results found for your search criteria.
            </p>
            <p class="text-gray-500 mt-2">Try adjusting your search terms or search type.</p>
          </div>`;
        
        // Update header and search type
        dynamicHeader.textContent = `No Results Found`;
        searchTypeDisplay.textContent = `Search Type: ${searchType}`;
        dynamicResultsSection.classList.remove('hidden');
        return;
      }

      // Update header with search info
      const searchQuery = searchInput.value.trim();
      dynamicHeader.textContent = `${searchType}: ${searchQuery}`;
      searchTypeDisplay.textContent = `Search Type: ${searchType}`;

      // Display stat cards with the first design (beautiful gradient cards)
      dynamicResultsContainer.innerHTML = `
        <!-- Issued Books Card -->
        <div class="p-8 rounded-2xl bg-gradient-to-br from-green-100 via-green-50 to-green-200 shadow-xl transform hover:scale-105 transition-all duration-300 border-2 border-green-300 hover:border-green-400 hover:shadow-2xl">
          <div class="relative">
            <!-- Background decoration -->
            <div class="absolute inset-0 bg-gradient-to-br from-green-200/30 to-transparent rounded-xl"></div>
            
            <div class="relative z-10">
              <div class="inline-flex items-center justify-center w-16 h-16 bg-green-200 rounded-full mb-4 shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 20H6a2 2 0 01-2-2V6a2 2 0 012-2h6m6 16V6m0 0l-4 4m4-4l4 4" />
                </svg>
              </div>
              <h4 class="text-2xl font-bold text-green-800 mb-2">Issued Books</h4>
              <p class="text-5xl font-bold text-green-700 mb-2 drop-shadow-sm">${stats.issued || 0}</p>
              <p class="text-green-600 font-medium">Currently Borrowed</p>
            </div>
          </div>
        </div>

        <!-- Available Books Card -->
        <div class="p-8 rounded-2xl bg-gradient-to-br from-blue-100 via-blue-50 to-blue-200 shadow-xl transform hover:scale-105 transition-all duration-300 border-2 border-blue-300 hover:border-blue-400 hover:shadow-2xl">
          <div class="relative">
            <!-- Background decoration -->
            <div class="absolute inset-0 bg-gradient-to-br from-blue-200/30 to-transparent rounded-xl"></div>
            
            <div class="relative z-10">
              <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-200 rounded-full mb-4 shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 text-blue-700">
                  <path d="M3.75 6.75c2.25-1.25 5.25-1.25 7.5 0v10.5c-2.25-1.25-5.25-1.25-7.5 0V6.75zm16.5 0c2.25-1.25 5.25-1.25-7.5 0v10.5c2.25-1.25 5.25-1.25 7.5 0V6.75z" />
                </svg>
              </div>
              <h4 class="text-2xl font-bold text-blue-800 mb-2">Available Books</h4>
              <p class="text-5xl font-bold text-blue-700 mb-2 drop-shadow-sm">${stats.available || 0}</p>
              <p class="text-blue-600 font-medium">Ready to Borrow</p>
            </div>
          </div>
        </div>

        <!-- Total Books Card -->
        <div class="p-8 rounded-2xl bg-gradient-to-br from-purple-100 via-purple-50 to-purple-200 shadow-xl transform hover:scale-105 transition-all duration-300 border-2 border-purple-300 hover:border-purple-400 hover:shadow-2xl">
          <div class="relative">
            <!-- Background decoration -->
            <div class="absolute inset-0 bg-gradient-to-br from-purple-200/30 to-transparent rounded-xl"></div>
            
            <div class="relative z-10">
              <div class="inline-flex items-center justify-center w-16 h-16 bg-purple-200 rounded-full mb-4 shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                </svg>
              </div>
              <h4 class="text-2xl font-bold text-purple-800 mb-2">Total Books</h4>
              <p class="text-5xl font-bold text-purple-700 mb-2 drop-shadow-sm">${stats.total || 0}</p>
              <p class="text-purple-600 font-medium">In Collection</p>
            </div>
          </div>
        </div>
      `;

      // Show the dynamic results section
      dynamicResultsSection.classList.remove('hidden');
      searchInput.value = ''; // Clear the search input
      // Scroll to the dynamic results
      dynamicResultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Initialize
    updateDisplay();
  </script>

</body>

</html>